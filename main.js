(()=>{"use strict";var t=document.querySelector(".places").querySelector(".places__list"),e=document.querySelector(".page__content"),n=e.querySelector(".popup_type_edit"),r=n.querySelector(".popup__form"),o=r.querySelector(".popup__input_type_name"),c=r.querySelector(".popup__input_type_description"),a=e.querySelector(".popup_type_new-card"),i=a.querySelector(".popup__form"),u=i.querySelector(".popup__input_type_card-name"),l=i.querySelector(".popup__input_type_url"),s=e.querySelector(".popup_type_avatar"),d=s.querySelector(".popup__form"),p=d.querySelector(".popup__input_type_avatar"),f=e.querySelector(".popup_type_image"),_=f.querySelector(".popup__image"),y=f.querySelector(".popup__caption"),m=e.querySelector(".profile"),v=m.querySelector(".profile__edit-button"),h=m.querySelector(".profile__add-button"),b=m.querySelector(".profile__image"),S=m.querySelector(".profile__title"),g=m.querySelector(".profile__description"),q=Array.from(document.querySelectorAll(".popup")),C=document.getElementById("card-template").content,E={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},L={baseUrl:"https://nomoreparties.co/v1/wff-cohort-7",headers:{authorization:"d91bb696-bf7c-4bbc-813c-61c020fbdf72","Content-Type":"application/json"}};function k(){return q.find((function(t){return t.classList.contains("popup_is-opened")}))}var x=function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))},A=function(t,e,n,r,o,c,a){var i=C.cloneNode(!0),u=i.querySelector(".card__delete-button"),l=i.querySelector(".card__image"),s=i.querySelector(".card__title"),d=i.querySelector(".card__like-button"),p=i.querySelector(".card__count"),f=function(t){p.textContent=t.likes.length};return f(t),t.likes.some((function(t){return t._id===r}))?d.classList.add("card__like-button_is-active"):d.classList.remove("card__like-button_is-active"),d.addEventListener("click",(function(t){var e,r;(e=n,r=t.target.classList.contains("card__like-button_is-active"),fetch("".concat(L.baseUrl,"/cards/likes/").concat(e),{method:r?"DELETE":"PUT",headers:L.headers}).then((function(t){return x(t)}))).then((function(t){f(t)})).then((function(){return a(t)})).catch(console.error).finally(console.log("Выполнено успешно"))})),e===r&&(u.classList.add("card__delete-button-visible"),u.disabled=!1,u.addEventListener("click",(function(t){(function(t){return fetch("".concat(L.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:L.headers}).then((function(t){return x(t)}))})(n).then((function(){return o(t)})).catch((function(t){console.log(t)})).finally((function(){return console.log("Выполнено успешно")}))}))),l.src=t.link,l.alt=t.name,s.textContent=t.name,l.addEventListener("click",c),i};function T(t){t.target.closest(".card").remove()}function U(t){t.target.classList.toggle("card__like-button_is-active")}function j(t){t.classList.add("popup_is-opened"),document.addEventListener("keydown",B)}function w(t){t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",B)}function B(t){var e=k();"Escape"===t.key&&w(e)}function P(t){t.target===t.currentTarget&&w(t.target)}var O,I,D=function(t,e,n){var r=t.querySelector(".".concat(e.id,"-error"));e.classList.remove(n.inputErrorClass),r.classList.remove(n.errorClass),r.textContent=""},M=function(t,e,n){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?(e.disabled=!1,e.classList.remove(n.inactiveButtonClass)):(e.disabled=!0,e.classList.add(n.inactiveButtonClass))},N=function(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),r=t.querySelector(e.submitButtonSelector);r.classList.add(e.inactiveButtonClass),n.forEach((function(n){n.value="",D(t,n,e),r.disabled=!0,r.classList.add(e.inactiveButtonClass)}))};function z(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function J(t){_.src=t.target.src,_.alt=t.target.alt,y.textContent=t.target.alt,j(f)}function G(t){w(t.target.closest(".popup"))}q.forEach((function(t){t.classList.add("popup_is-animated")})),v.addEventListener("click",(function(t){o.value=S.textContent,c.value=g.textContent,t.stopPropagation(),j(n)})),h.addEventListener("click",(function(t){t.stopPropagation(),N(a,E),j(a)})),b.addEventListener("click",(function(t){t.stopPropagation(),N(s,E),j(s)})),q.forEach((function(t){t.querySelector(".popup__close").addEventListener("click",G),t.addEventListener("click",P)})),r.addEventListener("submit",(function(t){t.preventDefault();var e=o.value,n=c.value;t.submitter.textContent="Cохранение...",function(t,e){return fetch("".concat(L.baseUrl,"/users/me"),{method:"PATCH",headers:L.headers,body:JSON.stringify({name:t,about:e})}).then((function(t){return x(t)}))}(e,n).then((function(){S.textContent=e,g.textContent=n})).then((function(){return w(k())}))})),i.addEventListener("submit",(function(e){e.preventDefault();var n,r,o={name:u.value,link:l.value};(n=o.name,r=o.link,fetch("".concat(L.baseUrl,"/cards"),{method:"POST",headers:L.headers,body:JSON.stringify({name:n,link:r})}).then((function(t){return x(t)}))).then((function(e){var n=A(e,O,e._id,O,T,J,U);t.prepend(n)})).then((function(){return i.reset()})).then((function(){return w(k())})).catch((function(t){console.log(t)})),e.submitter.textContent="Cохранение..."})),d.addEventListener("submit",(function(t){t.preventDefault();var e,n=p.value;(e=n,fetch("".concat(L.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:{authorization:"".concat(L.headers.authorization),"Content-Type":"application/json"},body:JSON.stringify({avatar:e})}).then((function(t){return x(t)}))).then((function(t){return b.style.backgroundImage="url(".concat(t,")")})).then(t.submitter.textContent="Cохранение...").then((function(){return w(k())})).then((function(){b.style.backgroundImage="url(".concat(n,")")})).catch((function(t){console.log(t)}))})),Promise.all([fetch("".concat(L.baseUrl,"/users/me"),{method:"GET",headers:L.headers}).then((function(t){return x(t)})),fetch("".concat(L.baseUrl,"/cards"),{method:"GET",headers:L.headers}).then((function(t){return x(t)}))]).then((function(e){var n,r,o=(r=2,function(t){if(Array.isArray(t))return t}(n=e)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,c,a,i=[],u=!0,l=!1;try{if(c=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=c.call(n)).done)&&(i.push(r.value),i.length!==e);u=!0);}catch(t){l=!0,o=t}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw o}}return i}}(n,r)||function(t,e){if(t){if("string"==typeof t)return z(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?z(t,e):void 0}}(n,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),c=o[0],a=o[1];O=c._id,a.forEach((function(e){S.textContent=c.name,g.textContent=c.about,b.style.backgroundImage="url('".concat(c.avatar,"')");var n=e.owner._id,r=e._id;t.append(A(e,n,r,O,T,J,U))}))})).catch((function(t){console.log(t)})).finally((function(){return console.log("Выполнено успешно")})),I=E,document.querySelectorAll(I.formSelector).forEach((function(t){!function(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),r=t.querySelector(e.submitButtonSelector);M(n,r,e),n.forEach((function(o){o.addEventListener("input",(function(){!function(t,e,n){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?D(t,e,n):function(t,e,n,r){var o=t.querySelector(".".concat(e.id,"-error"));e.classList.add(r.inputErrorClass),o.textContent=n,o.classList.add(r.errorClass)}(t,e,e.validationMessage,n)}(t,o,e),M(n,r,e)}))}))}(t,I)}))})();